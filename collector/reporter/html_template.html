<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´µé‡‘å±å¸‚åœºæ¯æ—¥æŠ¥å‘Š â€“ {{ target_date }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* å¤´éƒ¨ */
        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header .date {
            font-size: 16px;
            color: #a0c4ff;
        }

        /* æ™¯æ°”åº¦è¯„åˆ†å¡ */
        .score-card {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .score-card .score {
            font-size: 56px;
            font-weight: 700;
        }

        .score-card .label {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 4px;
        }

        .score-card .verdict {
            font-size: 18px;
            font-weight: 600;
            margin-top: 8px;
        }

        /* åˆ†åŒºå¡ç‰‡ */
        .section {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .section h2 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #eee;
            color: #1a1a2e;
        }

        .section h2 .icon {
            margin-right: 8px;
        }

        /* æ•°æ®è¡¨æ ¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th {
            background: #f8f9fa;
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }

        td {
            padding: 10px 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        tr:hover td {
            background: #f8f9fa;
        }

        .positive {
            color: #27ae60;
            font-weight: 600;
        }

        .negative {
            color: #e74c3c;
            font-weight: 600;
        }

        .neutral {
            color: #7f8c8d;
        }

        .missing {
            color: #bdc3c7;
            font-style: italic;
        }

        /* æ ‡ç­¾ */
        .tag {
            display: inline-block;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .tag-contango {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .tag-backwardation {
            background: #fce4ec;
            color: #c62828;
        }

        .tag-flat {
            background: #f5f5f5;
            color: #757575;
        }

        .tag-high {
            background: #ffebee;
            color: #c62828;
        }

        .tag-medium {
            background: #fff3e0;
            color: #e65100;
        }

        .tag-low {
            background: #e8f5e9;
            color: #2e7d32;
        }

        /* å›¾è¡¨ */
        .chart-img {
            width: 100%;
            max-width: 750px;
            margin: 16px auto 0;
            display: block;
            border-radius: 6px;
        }

        /* é¡µè„š */
        .footer {
            text-align: center;
            font-size: 12px;
            color: #95a5a6;
            padding: 20px 0;
            border-top: 1px solid #eee;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <div class="container">

        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ“Š è´µé‡‘å±å¸‚åœºæ¯æ—¥æŠ¥å‘Š</h1>
            <div class="date">{{ target_date }}</div>
        </div>

        {% if has_stale_data %}
        <div
            style="background-color: #fff3e0; border-left: 4px solid #e65100; padding: 16px; margin-bottom: 20px; border-radius: 4px; color: #e65100; font-weight: 600;">
            âš ï¸ è­¦å‘Šï¼šéƒ¨åˆ†æŒ‡æ ‡ä»Šæ—¥å°šæœªæ›´æ–°ï¼ˆå¯èƒ½æ˜¯æœªæ”¶ç›˜/ç»“æ¯å»¶è¿Ÿï¼‰ï¼Œä»¥ä¸‹æ­£åœ¨å±•ç¤ºæœ€è¿‘ä¸€ä¸ªæœ‰æ•ˆäº¤æ˜“æ—¥çš„å¯ç”¨æ•°æ®ï¼ˆè¯¦è§è¡¨æ ¼æ˜ç»†ï¼‰ã€‚
        </div>
        {% endif %}

        <!-- ç»¼åˆæ™¯æ°”åº¦è¯„åˆ† -->
        <div class="score-card">
            <div class="label">ç»¼åˆæ™¯æ°”åº¦è¯„åˆ†</div>
            <div class="score" style="color: {{ score_color }}">{{ overall_score }}</div>
            <div class="verdict" style="color: {{ score_color }}">{{ score_verdict }}</div>
        </div>

        <!-- 1. åº“å­˜ä¸äº¤å‰²å‹åŠ› -->
        <div class="section">
            <h2><span class="icon">ğŸ­</span>åº“å­˜ä¸äº¤å‰²å‹åŠ›</h2>
            <table>
                <thead>
                    <tr>
                        <th>æŒ‡æ ‡</th>
                        <th>é»„é‡‘ (Gold)</th>
                        <th>ç™½é“¶ (Silver)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>DPI (äº¤å‰²å‹åŠ›æŒ‡æ•°)</td>
                        <td>
                            {% if metrics.get('GOLD_dpi') %}
                            <span{% if metrics.get('GOLD_dpi', {}).get('date_suffix') %} class="missing" {% endif %}>{{
                                metrics.get('GOLD_dpi', {}).get('value', 'N/A') }}{{ metrics.get('GOLD_dpi',
                                {}).get('date_suffix', '') }}</span>
                                <span
                                    class="tag tag-{{ 'high' if 'é«˜' in metrics.get('GOLD_dpi', {}).get('description', '') else ('medium' if 'ä¸­' in metrics.get('GOLD_dpi', {}).get('description', '') else 'low') }}">
                                    {{ metrics.get('GOLD_dpi', {}).get('description', '') }}
                                </span>
                                {% else %}<span class="missing">N/A</span>{% endif %}
                        </td>
                        <td>
                            {% if metrics.get('SILVER_dpi') %}
                            <span{% if metrics.get('SILVER_dpi', {}).get('date_suffix') %} class="missing" {% endif %}>
                                {{ metrics.get('SILVER_dpi', {}).get('value', 'N/A') }}{{ metrics.get('SILVER_dpi',
                                {}).get('date_suffix', '') }}</span>
                                <span
                                    class="tag tag-{{ 'high' if 'é«˜' in metrics.get('SILVER_dpi', {}).get('description', '') else ('medium' if 'ä¸­' in metrics.get('SILVER_dpi', {}).get('description', '') else 'low') }}">
                                    {{ metrics.get('SILVER_dpi', {}).get('description', '') }}
                                </span>
                                {% else %}<span class="missing">N/A</span>{% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>åº“å­˜å˜åŠ¨ç‡ (%)</td>
                        <td
                            class="{{ 'positive' if (metrics.get('GOLD_inv_change_pct', {}).get('value', 0) or 0) > 0 else ('negative' if metrics.get('GOLD_inv_change_pct') else 'missing') }}">
                            {% if metrics.get('GOLD_inv_change_pct') %}<span{% if metrics.get('GOLD_inv_change_pct',
                                {}).get('date_suffix') %} class="missing" {% endif %}>{{
                                "{:.2f}".format(metrics.get('GOLD_inv_change_pct', {}).get('value') | float) }}%{{
                                metrics.get('GOLD_inv_change_pct', {}).get('date_suffix', '') }}</span>{% else
                                %}N/A{% endif %}
                        </td>
                        <td
                            class="{{ 'positive' if (metrics.get('SILVER_inv_change_pct', {}).get('value', 0) or 0) > 0 else ('negative' if metrics.get('SILVER_inv_change_pct') else 'missing') }}">
                            {% if metrics.get('SILVER_inv_change_pct') %}<span{% if metrics.get('SILVER_inv_change_pct',
                                {}).get('date_suffix') %} class="missing" {% endif %}>{{
                                "{:.2f}".format(metrics.get('SILVER_inv_change_pct', {}).get('value') | float) }}%{{
                                metrics.get('SILVER_inv_change_pct', {}).get('date_suffix', '') }}</span>{% else
                                %}N/A{% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 2. ä»·æ ¼ç»“æ„ -->
        <div class="section">
            <h2><span class="icon">ğŸ“ˆ</span>ä»·æ ¼ç»“æ„ä¸åŸºå·®</h2>
            <table>
                <thead>
                    <tr>
                        <th>æŒ‡æ ‡</th>
                        <th>é»„é‡‘ (Gold)</th>
                        <th>ç™½é“¶ (Silver)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>è¿‘æœˆåŸºå·®</td>
                        <td>{% if metrics.get('GOLD_basis') %}<span{% if metrics.get('GOLD_basis',
                                {}).get('date_suffix') %} class="missing" {% endif %}>{{ metrics.get('GOLD_basis',
                                {}).get('value', 'N/A') }}{{ metrics.get('GOLD_basis', {}).get('date_suffix', '')
                                }}</span>{%
                                else %}<span class="missing">N/A</span>{% endif %}</td>
                        <td>{% if metrics.get('SILVER_basis') %}<span{% if metrics.get('SILVER_basis',
                                {}).get('date_suffix') %} class="missing" {% endif %}>{{ metrics.get('SILVER_basis',
                                {}).get('value', 'N/A') }}{{ metrics.get('SILVER_basis', {}).get('date_suffix', '')
                                }}</span>{% else %}<span class="missing">N/A</span>{% endif %}</td>
                    </tr>
                    <tr>
                        <td>åŸºå·®/ç°è´§ (%)</td>
                        <td>{% if metrics.get('GOLD_basis_rel') %}<span{% if metrics.get('GOLD_basis_rel',
                                {}).get('date_suffix') %} class="missing" {% endif %}>{{ metrics.get('GOLD_basis_rel',
                                {}).get('value', 'N/A') }}%{{ metrics.get('GOLD_basis_rel', {}).get('date_suffix', '')
                                }}</span>{% else %}<span class="missing">N/A</span>{% endif %}</td>
                        <td>{% if metrics.get('SILVER_basis_rel') %}<span{% if metrics.get('SILVER_basis_rel',
                                {}).get('date_suffix') %} class="missing" {% endif %}>{{ metrics.get('SILVER_basis_rel',
                                {}).get('value', 'N/A') }}%{{ metrics.get('SILVER_basis_rel', {}).get('date_suffix', '')
                                }}</span>{% else %}<span class="missing">N/A</span>{% endif %}</td>
                    </tr>
                    <tr>
                        <td>æœŸé™ç»“æ„</td>
                        <td>
                            {% set gold_ts = metrics.get('GOLD_ts_slope', {}).get('description', '') %}
                            {% if 'Contango' in gold_ts %}
                            <span class="tag tag-contango">Contango</span>
                            {% elif 'Backwardation' in gold_ts %}
                            <span class="tag tag-backwardation">Backwardation</span>
                            {% else %}
                            <span class="tag tag-flat">{{ gold_ts or 'N/A' }}</span>
                            {% endif %}
                            {% if metrics.get('GOLD_ts_slope', {}).get('date_suffix') %}<span class="missing">{{
                                metrics.get('GOLD_ts_slope', {}).get('date_suffix') }}</span>{% endif %}
                        </td>
                        <td>
                            {% set silver_ts = metrics.get('SILVER_ts_slope', {}).get('description', '') %}
                            {% if 'Contango' in silver_ts %}
                            <span class="tag tag-contango">Contango</span>
                            {% elif 'Backwardation' in silver_ts %}
                            <span class="tag tag-backwardation">Backwardation</span>
                            {% else %}
                            <span class="tag tag-flat">{{ silver_ts or 'N/A' }}</span>
                            {% endif %}
                            {% if metrics.get('SILVER_ts_slope', {}).get('date_suffix') %}<span class="missing">{{
                                metrics.get('SILVER_ts_slope', {}).get('date_suffix') }}</span>{% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>
            {% if price_chart %}
            <img src="{{ price_chart }}" alt="è¿‘æœŸæœŸè´§ä»·æ ¼èµ°åŠ¿" class="chart-img">
            {% endif %}
        </div>

        <!-- 3. èµ„é‡‘æµä¸æŒä»“ -->
        <div class="section">
            <h2><span class="icon">ğŸ’°</span>èµ„é‡‘æµä¸æŒä»“ç»“æ„</h2>
            <table>
                <thead>
                    <tr>
                        <th>æŒ‡æ ‡</th>
                        <th>é»„é‡‘ (Gold / GLD)</th>
                        <th>ç™½é“¶ (Silver / SLV)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ETF æ—¥åº¦å‡€æµå…¥</td>
                        <td
                            class="{{ 'positive' if (metrics.get('GOLD_etf_flow', {}).get('value', 0) or 0) > 0 else ('negative' if metrics.get('GOLD_etf_flow') else 'missing') }}">
                            {% if metrics.get('GOLD_etf_flow') %}<span{% if metrics.get('GOLD_etf_flow',
                                {}).get('date_suffix') %} class="missing" {% endif %}>{{ metrics.get('GOLD_etf_flow',
                                {}).get('value', 'N/A') }}{{ metrics.get('GOLD_etf_flow', {}).get('date_suffix', '')
                                }}</span>{% else %}N/A{% endif %}
                        </td>
                        <td
                            class="{{ 'positive' if (metrics.get('SILVER_etf_flow', {}).get('value', 0) or 0) > 0 else ('negative' if metrics.get('SILVER_etf_flow') else 'missing') }}">
                            {% if metrics.get('SILVER_etf_flow') %}<span{% if metrics.get('SILVER_etf_flow',
                                {}).get('date_suffix') %} class="missing" {% endif %}>{{ metrics.get('SILVER_etf_flow',
                                {}).get('value', 'N/A') }}{{ metrics.get('SILVER_etf_flow', {}).get('date_suffix', '')
                                }}</span>{% else %}N/A{% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>æŠ•æœºæ‹¥æŒ¤åº¦</td>
                        <td>{% if metrics.get('GOLD_spec_crowding') %}<span{% if metrics.get('GOLD_spec_crowding',
                                {}).get('date_suffix') %} class="missing" {% endif %}>{{
                                metrics.get('GOLD_spec_crowding', {}).get('value', 'N/A') }}{{
                                metrics.get('GOLD_spec_crowding', {}).get('date_suffix', '') }}</span>{% else %}<span
                                    class="missing">N/A</span>{% endif %}</td>
                        <td>{% if metrics.get('SILVER_spec_crowding') %}<span{% if metrics.get('SILVER_spec_crowding',
                                {}).get('date_suffix') %} class="missing" {% endif %}>{{
                                metrics.get('SILVER_spec_crowding', {}).get('value', 'N/A') }}{{
                                metrics.get('SILVER_spec_crowding', {}).get('date_suffix', '') }}</span>{% else %}<span
                                    class="missing">N/A</span>{% endif %}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 4. åº“å­˜å¿«ç…§ -->
        {% if inventory_snapshot %}
        <div class="section">
            <h2><span class="icon">ğŸ“¦</span>åº“å­˜æ•°æ®å¿«ç…§</h2>
            <table>
                <thead>
                    <tr>
                        <th>äº¤æ˜“æ‰€</th>
                        <th>é‡‘å±</th>
                        <th>ç±»åˆ«</th>
                        <th>åº“å­˜é‡</th>
                        <th>å•ä½</th>
                        <th>æ•°æ®æ—¥æœŸ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in inventory_snapshot %}
                    <tr>
                        <td>{{ row.exchange }}</td>
                        <td>{{ 'é»„é‡‘' if row.metal == 'gold' else ('ç™½é“¶' if row.metal == 'silver' else row.metal) }}</td>
                        <td>{{ row.category }}</td>
                        <td>{{ "{:,.0f}".format(row.inventory) }}</td>
                        <td>{{ row.unit }}</td>
                        <td><span style="font-size: 12px; color: #7f8c8d;">{{ row.date }}</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if inventory_chart %}
            <img src="{{ inventory_chart }}" alt="COMEX åº“å­˜è¶‹åŠ¿" class="chart-img">
            {% endif %}
        </div>
        {% endif %}

        <!-- 5. ä»·æ ¼å¿«ç…§ -->
        {% if price_snapshot %}
        <div class="section">
            <h2><span class="icon">ğŸ’²</span>ä»·æ ¼æ•°æ®å¿«ç…§{% if fx_rate %} <span
                    style="font-size:13px;font-weight:400;color:#7f8c8d;">ï¼ˆUSDCNH: {{ fx_rate }}ï¼‰</span>{% endif %}</h2>
            <table>
                <thead>
                    <tr>
                        <th>äº¤æ˜“æ‰€/å¸‚åœº</th>
                        <th>é‡‘å±</th>
                        <th>åˆçº¦</th>
                        <th>æ”¶ç›˜ä»·</th>
                        <th>å¸ç§</th>
                        <th>CNY ä»·æ ¼</th>
                        <th>æ•°æ®æ—¥æœŸ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in price_snapshot %}
                    <tr>
                        <td>{{ row.get('exchange', row.get('market', '')) }}</td>
                        <td>{{ 'é»„é‡‘' if row.metal == 'gold' else ('ç™½é“¶' if row.metal == 'silver' else row.metal) }}</td>
                        <td>{{ row.get('contract', 'ç°è´§') }}</td>
                        <td>{{ "{:,.2f}".format(row.get('close_price', row.get('price', 0))) }}</td>
                        <td>{{ row.get('currency', '') }}</td>
                        <td>{% if row.price_cny %}{{ "{:,.2f}".format(row.price_cny) }}{% else %}<span
                                class="missing">N/A</span>{% endif %}</td>
                        <td><span style="font-size: 12px; color: #7f8c8d;">{{ row.date }}</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- é¡µè„š -->
        <div class="footer">
            <p>ğŸ“Š è´µé‡‘å±æ—¥åº¦è‡ªåŠ¨åŒ–ç ”ç©¶ç³»ç»Ÿ | æ•°æ®æ¥æº: CME/COMEX, SHFE, CFTC, Yahoo Finance, AkShare</p>
            <p>æŠ¥å‘Šç”Ÿæˆæ—¶é—´: {{ generated_at }} | âš ï¸ æœ¬æŠ¥å‘Šä»…ä¾›ç ”ç©¶å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®</p>
        </div>

    </div>
</body>

</html>